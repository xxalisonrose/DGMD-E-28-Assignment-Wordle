<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Wordle, the DGMD E-28 Version</title>
    <style>
      body {
        position: relative;
        max-width: 480px;
        height: 100%;
        margin: auto;
      }

      .box {
        position: relative;
        border-style: solid;
        border-width: 2px;
        padding: 1em;
        margin-top: 3em;
      }

      h1 {
        color: #016194;
        text-align: center;
        margin-bottom: 0;
      }

      h2 {
        color: #016194;
        text-align: center;
        margin-top: 0;
        margin-bottom: 2px;
      }

      #gameGrid {
        display: grid;
        grid-template-rows: repeat(5, 1fr); /* 5 columns */
        gap: 10px;
        justify-items: center;
      }

      .letterColumn {
        width: 70px;
        height: 70px;
        background-color: lightblue;
        border: 1px solid blue;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: xx-large;
      }

      .letterRow {
        display: flex;
        gap: 5px;
      }

      #keyboard {
        margin: 1rem 0;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      #keyboard div {
        display: flex;
      }

      .secondRow {
        margin: 0.5rem 0;
      }

      .keyboardButton {
        font-size: 1rem;
        font-weight: 700;
        padding: 0.5rem;
        margin: 0 2px;
        cursor: pointer;
        text-transform: uppercase;
      }

      .active-row {
        background-color: #acacac; /* Change to whatever color you want for the active row */
      }

      .buggy {
        background-color: black;
        color: limegreen;
      }

      .aboveGame {
        height: 100px;
        position: relative;
        border: 1px solid blue;
        margin-bottom: 5px;
        margin-top: 3px;
      }

      .topBtns {
        display: flex;
        justify-content: center;
      }

      #newGameBtn, 
      #hintBtn, 
      #defBtn {
        margin: 5px;
        margin-bottom: 2px;
      }

      #bugBtn, 
      #newGameBtn, 
      #hintBtn, 
      #defBtn {
      text-align: center;
      background-color: whitesmoke;
      color: black;
      border: 2px solid #e7e7e7;
      font-weight: bolder;
      }

      #bugBtn:hover, 
      #newGameBtn:hover, 
      #hintBtn:hover, 
      #defBtn:hover {
        background-color: lightcyan;
      }

      .hintBox {
        background-color: whitesmoke;
        color: black;
        border: 2px solid #e7e7e7;
      }

      #hints {
        position: relative;
      }

      #defBox, #hintBox {
      text-align: center;
      padding: 5px;
      }

      #debug {
        p: limegreen;
      }


    </style>
  </head>
  <body>
    <main>
      <!--a box around the game-->
      <div class="box">
        <h1>Wordle</h1>
        <h2>the DGMD E-28 Version</h2>

        <div class="aboveGame">
          <div class="topBtns">
          <button id="newGameBtn">New Game</button>
          <button id="hintBtn" onclick="hint(correctWord)">Hint</button>
          <button id="defBtn" onclick="defHint(correctWord)">Definition</button>
          </div>
        

        <div id="hints">
        <div id="hintBox" style="display: none;"></div>
        <div id="defBox" style="display: none;"></div>
        </div>
        </div>

        <!--5 x 6 Grid-->
        <div id="gameGrid"></div>

        <!--Display letter elements (not clickable ATM. maybe if there is time...)-->
        <div id="keyboard">
          <div class="firstRow">
            <button class="keyboardButton">q</button>
            <button class="keyboardButton">w</button>
            <button class="keyboardButton">e</button>
            <button class="keyboardButton">r</button>
            <button class="keyboardButton">t</button>
            <button class="keyboardButton">y</button>
            <button class="keyboardButton">u</button>
            <button class="keyboardButton">i</button>
            <button class="keyboardButton">o</button>
            <button class="keyboardButton">p</button>
          </div>
          <div class="secondRow">
            <button class="keyboardButton">a</button>
            <button class="keyboardButton">s</button>
            <button class="keyboardButton">d</button>
            <button class="keyboardButton">f</button>
            <button class="keyboardButton">g</button>
            <button class="keyboardButton">h</button>
            <button class="keyboardButton">j</button>
            <button class="keyboardButton">k</button>
            <button class="keyboardButton">l</button>
          </div>
          <div class="thirdRow">
            <button class="keyboardButton">z</button>
            <button class="keyboardButton">x</button>
            <button class="keyboardButton">c</button>
            <button class="keyboardButton">v</button>
            <button class="keyboardButton">b</button>
            <button class="keyboardButton">n</button>
            <button class="keyboardButton">m</button>
          </div>
        </div>

        <div id="debugGrid">
        <button id="bugBtn" onclick="bugMode()">Debug Mode</button>

        <div id="debug" style="display: none;"></div>
        </div>
        
      </div>
    </main>

    <script>
      // JS starts here
      console.log("JS loaded");

      // Debug Mode Features throughout Code: color change and displays the word with giveMeWord()
      //Debug Mode Color Change
      function bugMode() {
        var dark = document.body;
        dark.classList.toggle("buggy");
        }

      // New Game = Refresh page
      document
        .getElementById("newGameBtn")
        .addEventListener("click", function () {
          location.reload();
        });

      // Empty strings for correctWord and guessedWord
      var guessedWord = "";

      // Array of current guessed letters to turn into a word
      var currentGuess = [];

      // Total Guesses
      var guessesRemaining = 6;

      // For add/delete letter. Moves either forward a space or back a space
      var nextLetter = 0;

      // Create variables to store data
      var randomWord;
      var wordDef;
      var correctWord;
      var wordDef;

      // Starting row and column
      var currentRow = 0;
      var currentColumn = 0;

      // Create Game Board
      var board = document.getElementById("gameGrid");
      var numberRows = 6;
      var numberColumns = 5;

      // Create elements in HTML "div" for rows and columns based on board game specs
      function makeBoard() {
        // Create rows
        for (let i = 0; i < numberRows; i++) {
          var newRow = document.createElement("div");
          newRow.className = "letterRow";

          // Create columns and add them to the board
          for (let j = 0; j < numberColumns; j++) {
            var newColumn = document.createElement("div");
            newColumn.className = "letterColumn";
            newRow.appendChild(newColumn);
          }
          // Add rows to the columns
          board.appendChild(newRow);
        }
      }

      // Make game board
      makeBoard();

      // Get random word using Random Word API that automatically filters out words that aren't exactly 5 letters
    function newGame() {
      // Clear any saved data from previous games
      sessionStorage.clear();
      
      const wordURL = "https://random-word-api.herokuapp.com/word?length=5";

      async function getWord() {
        try {
          const wordResponse = await fetch(wordURL);
          if (!wordResponse.ok) {
            throw new Error("Failed to fetch word");
          }
          const wordData = await wordResponse.json();
          correctWord = wordData[0];

          // Testing
          console.log("Stored data: ", correctWord);
       
      // Call getDefinition() passing the correctWord
      getDefinition(correctWord);
    } catch (error) {
      console.error("Error loading the game:", error);
    }
  }

    // Function to fetch and store the definition of the random word
    async function getDefinition(correctWord) {
      try {
        const defURL = `https://api.dictionaryapi.dev/api/v2/entries/en/${correctWord}`;
        const defResponse = await fetch(defURL);
        if (!defResponse.ok) {
          throw new Error("Dictionary API request failed");
        }
        const defData = await defResponse.json();
        wordDef = defData[0].meanings[0].definitions[0].definition;

                // Testing that it matches
                console.log("Stored definition: ", wordDef);

      // Store word and definition in session storage to access data during the game
        sessionStorage.setItem("correctWord", correctWord);
        sessionStorage.setItem("definition", wordDef);

          //Assign words to be used outside of fetch block to variables
      } catch (error) {
        // If the random word isn't found in the dictionary
        console.error("Words are hard. Error:", error);
        location.reload();
      }
    }
      getWord();
    }
    newGame();

    // Access correctWord and wordDef after it's been assigned and pause a moment to make sure everything is assigned
setTimeout(() => {
    console.log("Correct Word Check: " + correctWord);
    console.log("Definition Check: " + wordDef)
}, 600);

      // Update the game board with the word
      function updateBoard() {
        // Get all the letter boxes
        var boxes = document.querySelectorAll(".letterColumn");

        // Split the word into characters
        var letters = correctWord.split("");

        // Update the letter boxes with the characters of the word
        for (var i = 0; i < boxes.length; i++) {
          // Convert all letters to uppercase
          boxes[i].textContent = letters[i];
        }
      }

      // Add key strokes in boxes
      document.addEventListener("keyup", (event) => {
        const pressedKey = event.key;

        // Ignore special keys
        if (pressedKey === "Backspace") {
          deleteLetter();
          return;
        }
        if (pressedKey === "Enter") {
          submitGuess();
          return;
        }

        // Validate if it's a letter
        const isValidKey = /^[a-zA-Z]$/i.test(pressedKey);
        if (!isValidKey) {
          // Provide feedback to the user about invalid input
          console.log("Please enter a valid letter.");
          return;
        }

        // Handle valid input
        addLetter(pressedKey.toUpperCase()); // Convert to uppercase for consistency
      });

      function moveNextRow() {
        const rows = document.getElementsByClassName("letterRow");

        // Check if rows is null or undefined
        if (!rows || rows.length === 0) {
          console.error("No rows found.");
          return;
        }

        // Calculate the next row index based on the remaining guesses
        const nextRowIndex = 6 - guessesRemaining;

        // Remove "active-row" class from all rows
        for (let i = 0; i < rows.length; i++) {
          rows[i].classList.remove("active-row");
        }

        // If the next row index is within bounds, add "active-row" class
        if (nextRowIndex >= 0 && nextRowIndex < numberRows) {
          rows[nextRowIndex].classList.add("active-row");
          currentRow = nextRowIndex; // Update the currentRow variable
          currentColumn = 0;
          currentGuess = [];
        }
      }

      // Used when the user submits their guess
      function submitGuess() {
        // Check to see if the guess is a valid word in the english language
        var guess = currentGuess.join("");

        wordValid(guess);

        // If you hit submit too soon
        if (guess.length != 5) {
          alert("Not enough letters!");
          return;
        }
        // If your word is correct OR if you run out of guesses
        if (guess === correctWord) {
          alert("You guessed right! Game over!");
          guessesRemaining = 0;
          winner();
          return;
        } else {
          guessesRemaining -= 1;

          console.log("Guesses Remaining: " + guessesRemaining);

          moveNextRow();
        }

        // If there are no remaining guesses, the game is over
        if (guessesRemaining === 0) {
          gameOver();
        }
      }

      // Add letter
      function addLetter(pressedKey) {
        // Get the row and box to add the letter
        const row = document.getElementsByClassName("letterRow")[currentRow];

        //All for testing to see if the letters are moving in the correct order
        //Debug mode?
        console.log("Current Row:", currentRow);
        console.log("Current Column:", currentColumn);
        // It needs to count 0 as 1 so - 1 to count the number of children
        console.log(
          "Number of Children:",
          row.children.length - currentColumn - 1
        );

        const box = row.children[currentColumn];

        // Check if box is undefined
        if (!box) {
          console.error("Box is undefined.");
          return;
        }

        // Insert the letter
        box.textContent = pressedKey;
        currentGuess.push(pressedKey);

        // Check if current row is full
        if (currentColumn != 4) {
          currentColumn++;
        } else {
          return;
        }
      }

      // Delete Letter
      function deleteLetter() {
        // Check if there are no letters to delete
        if (currentGuess.length === 0) {
          return;
        }

        // Move back to the previous column
        currentColumn--;

        // If moving back from the first column, move to the previous row
        if (currentColumn < 0) {
          currentRow--;
          // If moving back from the first row, ensure it doesn't go beyond the grid
          if (currentRow < 0) {
            currentRow = 0;
          }
          // Reset to last column of the previous row
          currentColumn = numberColumns - 1;
        }

        // Get the row and box of the last entered letter
        const row = document.getElementsByClassName("letterRow")[currentRow];
        const box = row.children[currentColumn];

        // Delete the letter
        box.textContent = "";
        currentGuess.pop();
      }

      // Add a function to compare the guessed word with the correct word and provide feedback
      function provideFeedback() {
        let feedback = [];
        for (let i = 0; i < 5; i++) {
          if (guessedWord[i] === correctWord[i]) {
            feedback.push("green"); // Correct letter in the correct position
          } else if (correctWord.includes(guessedWord[i])) {
            feedback.push("yellow"); // Correct letter in the wrong position
          } else {
            feedback.push("gray"); // Incorrect letter
          }
        }
        return feedback;
      }

      // Check if the guessed word is a valid English word
      function wordValid(guessedWord) {
        var dictionURL = `https://api.dictionaryapi.dev/api/v2/entries/en/${guessedWord}`;

        fetch(dictionURL)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Dictionary API request failed");
            }
            return response.json();
          })
          .then((data) => {
            if (data.length > 0) {
              // The guessed word is a valid English word
              console.log(`${guessedWord} is a valid English word.`);
            } else {
              // The guessed word is not a valid English word
              alert(`${guessedWord} is not a valid English word.`);
            }
          })
          .catch((error) => {
            // Handle errors from the API request
            console.error("Error:", error);
          });
      };

      function gameOver() {
        alert('You have run out of guesses! Game over!');
        alert(`The right word was: "${correctWord}"`);
      };

      function winner() {
        alert('You won!');
      }

      //Hint Box Section
      function hint(correctWord) {
        var firstLetter = correctWord[0];
        var numOne = firstLetter.toUpperCase();

        console.log("The first letter of the word is " + numOne);

        const x = document.getElementById("hintBox");
          if (x.style.display === "none") {
            x.style.display = "block";
          } else {
            x.style.display = "none";
          }

          x.innerHTML = "The first letter of the word is " + numOne;


      }

      function defHint(correctWord) {
        console.log(wordDef);

        const x = document.getElementById("defBox");
          if (x.style.display === "none") {
            x.style.display = "block";
          } else {
            x.style.display = "none";
          }

          x.innerHTML = wordDef;
        };
  

          function giveMeWord(correctWord) {
            var x = document.getElementById("debug");
      if (x.style.display === "none") {
        x.style.display = "block";
      } else {
        x.style.display = "none";
      }

      x.innerHTML = correctWord;
          };
      



      /*/
    
    for (let i = 0; i < 5; i++) {
        let letterColor = ''
        let box = row.children[i]
        let letter = currentGuess[i]
        
        let letterPosition = rightGuess.indexOf(currentGuess[i])
        // is letter in the correct guess
        if (letterPosition === -1) {
            letterColor = 'grey'
        } else {
            // now, letter is definitely in word
            // if letter index and right guess index are the same
            // letter is in the right position 
            if (currentGuess[i] === rightGuess[i]) {
                // shade green 
                letterColor = 'green'
            } else {
                // shade box yellow
                letterColor = 'yellow'
            }

            rightGuess[letterPosition] = "#"
        }

        let delay = 250 * i
        setTimeout(()=> {
            //shade box
            box.style.backgroundColor = letterColor
            shadeKeyBoard(letter, letterColor)
        }, delay)
    }


}




function shadeKeyBoard(letter, color) {
    for (const elem of document.getElementsByClassName("keyboardButton")) {
        if (elem.textContent === letter) {
            let oldColor = elem.style.backgroundColor
            if (oldColor === 'green') {
                return
            } 

            if (oldColor === 'yellow' && color !== 'green') {
                return
            }

            elem.style.backgroundColor = color
            break
        }
    }
}


/*/
    </script>
  </body>
</html>
